
import os
import re

STORAGE_DIR = "storage"
STORAGE_BLOCK_PREFIX = "IPBLK"
STORAGE_BLOCK_EXTENSION = "blk"
STORAGE_FIRST_BLOCK_NUMBER = 0
STORAGE_BLOCK_SIZE = 1005 #bytes (~ 1KiB)
UNCOMPRESSED_BLOCK_NUMBER = 3

IPS = ['134.51.185.48:64826', '146.11.135.201:54056', '183.57.22.156:65094', '24.212.212.59:53023', '14.189.10.42:61492', '169.187.59.49:50592', '93.97.119.40:63167', '176.219.130.96:59752', '98.145.182.82:55573', '10.193.196.83:59737', '129.250.115.71:62003', '52.40.177.245:50623', '69.233.234.130:59111', '48.8.181.121:50333', '67.213.58.250:58401', '146.94.246.81:50532', '68.218.145.172:54744', '34.173.171.139:56268', '108.54.166.147:58238', '105.138.246.115:61441', '20.13.180.142:61942', '179.199.249.234:64614', '64.201.243.254:61281', '51.31.167.234:62885', '125.6.120.88:56360', '106.64.220.24:59594', '10.126.79.202:50508', '71.11.252.164:53019', '131.53.99.107:49195', '92.216.234.228:54328', '36.79.207.183:56679', '50.159.84.48:56073', '162.233.195.150:62961', '64.82.172.208:58808', '56.69.223.170:52320', '104.128.83.224:52380', '20.17.242.253:50361', '111.21.104.47:61929', '176.16.160.158:52028', '155.75.118.173:64457', '78.211.27.149:59638', '103.38.206.154:56690', '53.190.132.13:64212', '55.8.87.243:54601', '127.248.126.29:50373', '160.86.61.119:64209', '150.116.190.232:56425', '68.22.13.55:58345', '60.214.214.232:63270', '76.135.57.246:64142', '140.136.76.4:59275', '152.101.161.13:64072', '57.208.43.199:57749', '21.79.146.237:62689', '109.170.128.253:56346', '129.231.134.79:62521', '188.10.84.125:53053', '148.72.226.191:52128', '76.204.134.116:53279', '128.76.73.207:54210', '61.232.118.9:59720', '18.16.231.201:62833', '141.190.87.80:58229', '58.87.119.223:58178', '138.64.158.51:52500', '185.103.121.16:50323', '179.30.73.146:57518', '143.150.192.34:61505', '61.72.173.233:56505', '36.51.95.121:51811', '14.72.226.146:57703', '88.44.239.139:61138', '167.159.72.229:56811', '26.43.173.114:49606', '47.102.113.172:51117', '25.51.239.164:63866', '79.226.106.61:54771', '145.123.63.150:49204', '28.223.140.165:53530', '115.80.48.26:50943', '148.123.220.188:62166', '58.26.225.177:55590', '100.50.133.161:58236', '160.4.39.77:62486', '159.183.162.109:61728', '97.225.150.186:62241', '155.191.228.48:65510', '98.93.86.39:50502', '93.124.76.191:49993', '49.192.27.160:58863', '19.2.254.4:60788', '104.229.29.7:53297', '140.148.158.232:58648', '76.155.145.205:61120', '49.157.86.35:57290', '121.210.65.115:56440', '141.139.89.200:50865', '178.71.81.219:58846', '171.143.197.244:57242', '26.173.135.56:63850', '62.203.207.162:58645', '173.69.20.242:64894', '64.56.169.199:61325', '140.69.54.44:60538', '123.152.215.65:65225', '41.152.239.69:49751', '112.24.134.27:51218', '176.232.37.110:62450', '4.11.51.2:64727', '28.65.161.185:51854', '11.253.75.244:60881', '182.6.37.155:63673', '181.171.151.198:62889', '180.165.87.235:55663', '62.150.126.128:55875', '171.224.183.73:62570', '24.142.230.58:49190', '77.182.158.111:64228', '113.159.92.83:52171', '114.44.139.149:52098', '22.81.129.99:61685', '155.100.176.190:55010', '37.93.91.104:59210', '182.96.238.197:58890', '21.145.211.82:61033', '167.104.205.110:61110', '128.103.139.70:50172', '141.170.3.251:53619', '94.192.46.209:56549', '147.86.64.224:54184', '99.27.43.116:57537', '45.208.42.234:63288', '3.132.95.111:55199', '186.248.113.136:64215', '95.178.76.195:56445', '133.248.213.235:55618', '185.210.186.254:62012', '76.26.33.118:53593', '163.82.54.75:57865', '10.37.87.176:64029', '58.221.234.1:62358', '30.121.210.146:61212', '68.32.11.58:58583', '2.252.61.191:64833', '65.82.167.142:63334', '71.42.162.176:59899', '78.225.48.128:52426', '66.129.68.76:49158', '47.214.236.14:52262', '71.186.244.198:49256', '175.238.116.107:62878', '13.246.58.162:62372', '68.176.87.134:60683', '169.24.38.131:57617', '177.68.110.98:62198', '121.36.212.96:62529', '112.213.30.202:64773', '106.120.12.102:50155', '105.111.225.243:51635', '134.30.108.230:60664', '55.23.231.136:52551', '117.253.161.34:64712', '171.104.142.152:49299', '16.242.141.218:65192', '131.36.37.15:52524', '191.164.63.5:55875', '28.43.12.207:65164', '24.249.220.241:58283', '101.40.192.72:54156', '107.12.237.133:62420', '121.175.150.91:61572', '157.70.235.159:55198', '100.93.251.162:53562', '59.40.218.208:51414', '77.94.95.134:60161', '18.130.113.66:51672', '111.81.230.80:61445', '86.91.71.63:55151', '14.190.232.65:53642', '34.162.84.145:61267', '14.60.219.67:53944', '68.133.126.72:51086', '167.208.54.113:56195', '127.229.90.117:59779', '17.26.240.165:65138', '80.74.128.116:62424', '181.117.222.252:59915', '56.9.140.232:62368', '157.156.159.115:56021', '145.127.133.88:54470', '42.17.108.130:52657', '139.108.191.191:64067', '57.109.216.27:60815', '39.35.246.229:58593', '99.247.107.215:56936', '110.58.241.234:57478', '183.190.151.156:51710', '139.58.97.28:55270', '115.190.160.32:54256', '34.154.143.136:53909', '46.145.231.156:51031', '13.114.216.217:57186', '92.161.86.29:62014', '145.230.34.74:53999', '155.83.150.235:61482', '7.164.134.246:49854', '58.118.140.249:62563', '150.251.174.160:52389', '38.94.16.21:54427', '127.219.201.52:49611', '30.122.196.56:58617', '187.217.145.67:49372', '3.207.253.91:50393', '31.145.237.244:51672', '100.211.190.170:55010', '137.185.99.244:53697', '94.115.185.119:53429', '7.66.70.35:60907', '178.157.164.73:62961', '172.126.205.93:60163', '51.248.166.80:56194', '114.62.54.186:60006', '162.227.62.250:64579', '134.47.155.113:58624', '11.180.143.37:59396', '25.204.238.133:59860', '182.27.87.84:61648', '60.63.205.189:59278', '112.65.17.243:57539', '59.117.45.88:53298', '45.168.238.226:60995', '125.27.178.173:58531', '66.183.139.79:51275', '107.123.128.125:60273', '88.219.177.95:64908', '116.254.60.88:58281', '105.93.83.13:54268', '82.254.16.156:56151', '95.217.109.11:60056', '20.178.93.34:52922', '85.17.106.99:61278', '21.37.121.16:56391', '14.8.78.24:54023', '76.209.44.231:61791', '117.179.76.161:55260', '114.213.119.244:61896', '146.114.149.102:52563', '58.70.72.56:53297', '93.32.92.219:56859', '44.101.93.65:61095', '168.33.70.244:55524', '45.155.79.236:61663', '109.236.253.243:50704', '174.106.182.243:58149', '2.242.186.148:51343', '55.222.20.131:55631', '43.103.13.25:60247', '48.22.21.90:63936', '66.231.148.180:52365', '22.237.244.212:49310', '58.240.216.135:50842', '92.69.86.236:50131', '8.254.26.95:57746', '96.141.179.11:62784', '101.181.137.240:60105', '93.144.80.89:57023', '116.75.44.156:57401', '30.200.143.52:61376', '47.72.156.220:61362', '69.149.20.245:52695', '120.76.230.86:49850', '162.207.99.40:58754', '95.230.139.232:52354', '37.104.111.78:65442', '142.28.234.220:58692', '48.64.250.65:49852', '40.219.214.2:63958', '106.16.204.76:59556', '132.230.78.149:58758', '113.122.168.244:54404', '168.212.98.15:65198', '178.51.175.100:58338', '31.229.19.165:59066', '92.55.83.223:52562', '135.123.225.33:52717', '141.140.241.70:50022', '190.85.185.234:56145', '91.104.61.58:53783', '42.8.132.219:54646', '103.10.208.212:57784', '48.198.216.61:57903', '124.103.163.54:60078', '65.108.200.75:50421', '55.236.233.180:59524', '24.178.82.199:49920', '8.72.163.170:52078', '55.127.219.26:61972', '89.123.241.190:54156', '50.200.176.42:58118', '160.104.216.181:51002', '56.173.109.151:49594', '128.140.97.69:61286', '103.77.229.16:58644', '176.186.169.106:52006', '18.104.202.184:58943', '90.196.145.214:52564', '67.239.148.224:53295', '66.69.91.131:52973', '13.67.165.148:63473', '70.216.181.214:56403', '92.116.150.81:57519', '36.225.42.165:64776', '180.238.210.13:52537', '69.172.184.241:52835', '1.166.76.32:54492', '185.25.254.14:61332', '98.192.34.177:63200', '179.72.22.60:56592', '133.34.11.229:51065', '69.5.17.97:56258', '111.145.184.96:61715', '66.181.250.211:60590', '99.234.75.219:57593', '5.244.81.30:60157', '78.105.104.28:58447', '11.176.29.141:53140', '85.134.194.29:62537', '69.4.94.107:63435', '98.239.114.218:49389', '169.163.44.36:57129', '150.176.236.242:53991', '122.245.240.153:63518', '56.226.13.156:54581', '82.36.239.230:54974', '81.99.111.77:55480', '105.52.115.128:63347', '1.54.245.73:55567', '192.13.3.110:60094', '30.13.172.88:51625', '152.150.166.1:49505', '133.254.138.1:62207', '4.123.138.166:59881', '19.107.56.3:57275', '82.154.130.100:59562', '64.206.135.225:56024', '148.74.135.32:60192', '111.187.154.213:58127', '82.237.65.183:49614', '102.209.147.190:57373', '44.236.139.50:61211', '75.211.153.128:62525', '129.48.81.173:61753', '33.58.68.48:63466', '48.200.94.39:61991', '74.253.65.211:55003', '160.149.124.157:64437', '27.110.78.23:59960', '48.77.137.104:59181', '126.115.167.110:62870', '3.150.4.254:55093', '126.165.40.123:60957', '101.111.66.209:60739', '188.135.78.20:55605', '95.23.199.114:59452', '120.22.148.84:59196', '127.208.3.138:63125', '138.230.43.98:51608', '95.192.239.17:49695', '157.198.77.156:50595', '49.7.221.181:63245', '135.78.1.94:50268', '53.55.207.146:51017', '109.29.235.203:58271', '171.1.93.223:57349', '86.48.98.71:51021', '93.118.211.148:62855', '124.159.61.144:56540', '159.146.168.41:59746', '50.245.221.99:53408', '19.128.126.76:51185', '13.13.182.122:59654', '7.111.29.45:63433', '178.2.200.135:64949', '103.92.184.108:64514', '1.96.53.160:59731', '69.149.114.75:56242', '19.43.53.117:61225', '31.189.120.146:59074', '22.114.132.178:64356', '55.111.195.29:63716', '177.225.185.13:55551', '87.153.232.79:64755', '36.16.109.102:58860', '69.193.232.225:59829', '11.212.28.244:65288', '35.124.24.226:59044', '12.166.171.84:55216', '188.244.17.35:51227', '157.5.153.118:53549', '166.135.207.96:57329', '191.173.191.97:63907', '71.112.146.247:56718', '13.220.140.116:62533', '58.30.205.207:60383', '89.116.68.193:63486', '15.119.222.187:61831', '119.197.19.182:51925', '104.147.104.39:60557', '45.208.166.84:52988', '36.53.94.150:57402', '34.78.2.246:49421', '65.106.215.135:62941', '77.98.231.38:50209', '177.189.245.118:50118', '128.149.25.6:59622', '173.63.235.154:49245', '22.181.49.146:51149', '115.170.220.199:62170', '80.225.113.142:55291', '185.241.149.217:61000', '106.111.63.115:64680', '20.177.238.42:56914', '33.221.133.86:54082', '28.19.250.32:56982', '8.214.244.181:49289', '191.62.183.231:57334', '25.188.181.121:60673', '72.157.120.215:56331', '94.198.163.198:58545', '178.180.54.245:57932', '96.54.134.60:59883', '164.49.166.211:65309', '70.88.72.79:60044', '174.27.42.142:51339', '172.107.170.145:53444', '42.33.154.166:58027', '81.222.25.161:61968', '121.74.205.29:50949', '41.69.6.239:55020', '167.188.110.29:55249', '87.115.14.153:61377', '189.154.135.140:53635', '182.38.181.97:60237', '20.24.88.86:51216', '183.209.84.117:62314', '184.201.71.48:53076', '76.89.61.150:57521', '87.11.140.92:49702', '28.39.28.96:58287', '151.164.78.193:53778', '126.246.70.143:52380', '47.54.180.186:61130', '151.165.43.17:57386', '164.149.200.51:54370', '42.28.193.66:51486', '87.54.17.160:58085', '145.206.184.205:59868', '73.228.172.89:59035', '21.200.59.180:51415', '179.205.104.51:58820', '136.185.254.39:58969', '145.247.11.231:55822', '163.22.64.161:50314', '61.252.98.237:49316', '173.241.41.206:52792', '189.8.246.183:61564', '4.127.83.43:49413', '126.125.151.238:50228', '142.251.141.98:60724', '100.140.62.32:56571', '92.109.237.80:52962', '80.123.47.238:55362', '116.3.33.84:55186', '37.74.133.71:60128', '135.239.5.73:55611', '44.90.70.194:63043', '22.249.251.216:58559', '98.140.144.153:55169', '79.133.6.15:53344', '101.228.106.42:58522', '30.236.120.247:58042', '94.247.229.181:54901', '46.238.152.103:63221', '167.20.91.94:54380', '24.49.53.190:56718', '86.220.112.101:58017', '108.12.15.68:52483', '45.174.52.107:56366', '154.229.58.41:56307', '111.208.18.61:58902', '1.4.187.155:64230', '99.194.140.52:64772', '179.192.235.43:57512', '70.240.93.76:54895', '10.59.144.168:58836', '20.103.142.181:62020', '109.250.5.182:50171', '107.56.95.12:49191', '84.189.2.187:65131', '157.69.176.7:58887']

def check_dir(loc):
    out = False
    if os.path.exists(loc):
        if os.path.isdir(loc):
            out = True
    return out

def get_last_block(sloc):
    onlyfiles = sorted([f for f in os.listdir(sloc) if os.path.isfile(os.path.join(sloc, f))])
    return onlyfiles[len(onlyfiles)-1]

def save_row(str_rows, sloc, bpre, bext, fbn, bsize):
    if len(os.listdir(sloc) ) == 0:
        print("[INFO] directory is empty")
    else:
        print("[INFO] directory is not empty")
        lbname = get_last_block(sloc)
        regex = re.compile(bpre+'([0-9]*)\.'+bext)
        lbn = int(regex.search(lbname)[1])

def main():
    if not check_dir(STORAGE_DIR): os.mkdir(STORAGE_DIR)
    # print(os.path.getsize("storage/1.blk"))
    # print(len('hola'.encode('utf-8')))
    my_str_rows = IPS[0]+"\n"+IPS[1]+"\n"+IPS[0]+"\n"
    save_row(my_str_rows, STORAGE_DIR, STORAGE_BLOCK_PREFIX, STORAGE_BLOCK_EXTENSION, STORAGE_FIRST_BLOCK_NUMBER, STORAGE_BLOCK_SIZE)

if __name__ == "__main__": main()
